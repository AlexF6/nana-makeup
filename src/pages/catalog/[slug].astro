---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import { Image } from "astro:assets";
import { products } from "../../data/products";

export function getStaticPaths() {
  return products.map((p) => ({
    params: { slug: p.slug },
    props: { product: p },
  }));
}

const { product } = Astro.props;

const cop = new Intl.NumberFormat("es-CO", {
  style: "currency",
  currency: "COP",
  maximumFractionDigits: 0,
});
---

<BaseLayout title={`${product.name} | NANA Beauty`}>
  <Header />

  <section class="relative py-12 md:py-16 bg-zinc-950 overflow-hidden">
    <!-- Textura de fondo (grid sutil) -->
    <div
      class="pointer-events-none absolute inset-0 opacity-[0.15]"
      style="
        background-image: linear-gradient(to right, rgba(236, 72, 153, 0.1) 1px, transparent 1px),
                          linear-gradient(to bottom, rgba(236, 72, 153, 0.1) 1px, transparent 1px);
        background-size: 40px 40px;
        mask-image: radial-gradient(circle at 50% 0%, black 42%, transparent 80%);
      "
    ></div>

    <main class="relative mx-auto w-[min(1200px,calc(100%-2rem))]">
      <a
        href="/catalog"
        class="inline-flex items-center gap-2 text-sm text-zinc-400 transition hover:text-pink-200"
      >
        <span aria-hidden="true">←</span> Volver al catálogo
      </a>

      <div class="mt-6 grid gap-8 lg:grid-cols-2">
        <!-- LEFT: Image Card -->
        <div
          class="animate-entry group rounded-4xl border border-white/10 bg-zinc-900/20 p-4
                 transition-all duration-500 hover:border-pink-500/30 hover:bg-zinc-900/40
                 hover:shadow-2xl hover:shadow-pink-900/10"
          style="--delay: 100ms"
        >
          <div class="relative overflow-hidden rounded-3xl bg-zinc-800/30">
            <div class="aspect-4/5 w-full">
              <Image
                src={product.image}
                alt={product.name}
                class="h-full w-full object-cover object-center p-6 transition duration-700 ease-in-out group-hover:scale-110"
                width={900}
                height={1125}
                loading="eager"
              />
            </div>

            <!-- Soft glow -->
            <div
              class="pointer-events-none absolute inset-0 opacity-0 transition duration-500 group-hover:opacity-100"
              style="background: radial-gradient(circle at center, rgba(236, 72, 153, 0.15) 0%, transparent 70%);"
            ></div>

            <!-- Ring sutil -->
            <div class="pointer-events-none absolute inset-0 rounded-3xl ring-1 ring-inset ring-white/5 group-hover:ring-white/10 transition-colors"></div>

            {product.badge && (
              <div class="absolute top-3 left-3">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-pink-500 text-white shadow-lg shadow-pink-500/20">
                  {product.badge}
                </span>
              </div>
            )}
          </div>
        </div>

        <!-- RIGHT: Info Card -->
        <div
          class="animate-entry rounded-4xl border border-white/10 bg-zinc-900/20 p-6 md:p-8
                 shadow-[0_18px_60px_rgba(0,0,0,0.35)]"
          style="--delay: 200ms"
        >
          <div class="flex flex-wrap items-center gap-2 text-sm text-zinc-400">
            <span class="rounded-full border border-white/10 bg-white/5 px-3 py-1">
              {product.category}
            </span>

            {typeof product.rating === "number" && (
              <span class="rounded-full border border-white/10 bg-white/5 px-3 py-1">
                ★ {product.rating.toFixed(1)}
              </span>
            )}
          </div>

          <h1 class="mt-4 text-3xl md:text-4xl font-black tracking-tight text-white">
            {product.name}
          </h1>

          <p class="mt-3 text-zinc-400 leading-relaxed">
            {product.desc}
          </p>

          <div class="mt-6 flex items-end justify-between gap-4">
            <div class="text-2xl md:text-3xl font-extrabold text-pink-200">
              {cop.format(product.priceCOP)}
            </div>

            <div class="text-xs text-zinc-500">
              Envío rápido • Pagos seguros
            </div>
          </div>

          <!-- Swatches -->
          {product.colors?.length ? (
            <div class="mt-7">
              <div class="flex items-center justify-between">
                <h2 class="text-sm font-semibold text-zinc-200">Color</h2>
                <span id="selectedColor" class="text-xs text-zinc-500">
                  {product.colors[0]}
                </span>
              </div>

              <div class="mt-3 flex flex-wrap gap-2" data-swatches>
                {product.colors.map((hex, i) => (
                  <button
                    type="button"
                    class:list={[
                      "h-5 w-5 rounded-full border border-white/10 transition-all duration-300",
                      i === 0
                        ? "ring-2 ring-pink-500 ring-offset-2 ring-offset-zinc-950 scale-110"
                        : "hover:scale-110 hover:border-white/50 opacity-80 hover:opacity-100",
                    ]}
                    style={`background-color:${hex};`}
                    aria-label={`Select color ${hex}`}
                    aria-pressed={i === 0 ? "true" : "false"}
                    data-hex={hex}
                  />
                ))}
              </div>
            </div>
          ) : null}

          <!-- CTAs -->
          <div class="mt-8 grid gap-3 sm:grid-cols-2">
            <button
              class="inline-flex items-center justify-center rounded-2xl px-5 py-3 font-semibold
                     bg-pink-600 text-white hover:bg-pink-500 active:translate-y-px
                     focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-500/40"
              type="button"
            >
              Agregar al carrito
            </button>

            <button
              class="inline-flex items-center justify-center rounded-2xl px-5 py-3 font-semibold
                     border border-white/10 bg-white/5 text-white backdrop-blur-sm
                     transition hover:border-pink-500/30 hover:bg-pink-500/10 hover:text-pink-200
                     active:translate-y-px
                     focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-500/30"
              type="button"
            >
              Comprar ahora
            </button>
          </div>

          <!-- Details -->
          <div class="mt-8 rounded-3xl border border-white/10 bg-zinc-950/40 p-5">
            <h2 class="text-zinc-100 font-semibold">Detalles</h2>
            <ul class="mt-2 space-y-2 text-sm text-zinc-300/90">
              <li>• Acabado: alta pigmentación</li>
              <li>• Sensación: cómodo y ligero</li>
              <li>• Estilo: punk/goth glam</li>
            </ul>
          </div>
        </div>
      </div>

      <script type="module" is:inline>
        const root = document.querySelector("[data-swatches]");
        if (root) {
          const label = document.getElementById("selectedColor");
          const buttons = Array.from(root.querySelectorAll("button[data-hex]"));

          function select(btn) {
            for (const b of buttons) {
              b.setAttribute("aria-pressed", "false");
              b.classList.remove("ring-2", "ring-pink-500", "ring-offset-2", "ring-offset-zinc-950", "scale-110");
              b.classList.add("opacity-80");
            }

            btn.setAttribute("aria-pressed", "true");
            btn.classList.add("ring-2", "ring-pink-500", "ring-offset-2", "ring-offset-zinc-950", "scale-110");
            btn.classList.remove("opacity-80");

            if (label) label.textContent = btn.dataset.hex || "";
          }

          buttons.forEach((b) => b.addEventListener("click", () => select(b)));
        }
      </script>

      <style>
        .animate-entry {
          opacity: 0;
          animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
          animation-delay: var(--delay, 0ms);
        }
        @keyframes fadeInUp {
          from { opacity: 0; transform: translateY(30px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @media (prefers-reduced-motion: reduce) {
          .animate-entry { opacity: 1; animation: none; transform: none; }
        }
      </style>
    </main>
  </section>
</BaseLayout>
